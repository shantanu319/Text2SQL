SELECT p.product_id, COUNT(*) as view_count, SUM(CASE WHEN c.cart_id IS NOT NULL THEN 1 ELSE 0 END) as add_to_cart_count, SUM(CASE WHEN c.cart_id IS NULL AND p.page_id IN (1, 2, 12, 13) THEN 1 ELSE 0 END) as leave_in_cart_count, COUNT(DISTINCT p.page_id) as purchase_count